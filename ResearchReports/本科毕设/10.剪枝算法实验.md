## \section{超参数对联邦训练的影响}

\label{sec:exp-superparameters}

在整个基于剪枝优化的大模型联邦训练算法中，有3个超参数的设置是值得讨论的，分别是模型剪枝算法中的整体剪枝率$\alpha$、初始调整系数$\lambda^0$和模型聚合算法中的初始权衡系数$\gamma^0$。在基于动态拓扑的模型剪枝算法中，当$\alpha$设置为0时，整个联邦学习的框架退化为不剪枝的情况，因此，\ref{subsec:exp-pruning-ratio}节将讨论不同数据划分情况下，是否引入网络剪枝技术以及不同的$\alpha$对联邦训练的影响，而\ref{subsec:exp-dynamic-ratio}节将讨论不同的$\lambda^0$对联邦训练的影响。最后，在基于贡献评估的模型聚合算法中，当$\gamma^0$设置为1时，模型加权聚合的方式与FedAvg算法相同，因此，\ref{subsec:exp-tradeoff-ratio}节将讨论模型聚合算法中是否引入贡献评估，以及不同的初始权衡系数$\gamma^0$对联邦训练的影响。



### \subsection{剪枝算法的整体剪枝率$\alpha$的影响}

\label{subsec:exp-pruning-ratio}

本小节研究客户端之间的样本标签独立同分布、非独立同分布以及含有噪声时，使用不同的整体剪枝率$\alpha$对本算法训练效果的影响。需要说明的是，本小节的实验结果可能仅在\ref{sec:setting}节声明的实验设置下有效，并不具备普遍意义。$\alpha=0$表示在边缘设备上训练的是与服务器相同的密集模型，联邦大模型不会被剪枝。本小节使用的数据集是CIFAR-10。此外，因为本小节主要关注的超参数是整体剪枝率$\alpha$，因此其他的超参数将会被固定，例如剪枝算法的初始调整系数$p^0=0$，聚合算法的初始权衡系数$\gamma^0=1$。图\ref{fig:fig_pruning_ratio}展示了样本标签独立同分布和非独立同分布情况下，联邦模型的测试准确率与整体剪枝率$\alpha$的关系。

首先，在整体剪枝率$\alpha$相同的情况下，样本标签非独立同分布会影响联邦训练的效果，使得联邦模型的测试准确率下降。其次，当剪枝率小于0.5时，测试准确率维持在一个较高的水平，当剪枝率大于0.5时，测试准确率开始下降，而剪枝率超过0.8时，下降的幅度显著增大。这一实验结果反映了一定程度的剪枝不会对联邦模型的精度造成太大的影响，然而在高剪枝率的需求下，剪枝模型的结构会被严重破坏，使得联邦模型的学习性能显著下降。

图\ref{fig:fig_noisy_ratio}展示了样本标签添加噪声时不同剪枝率的联邦训练情况。左图的实验结果显示，固定$\alpha$，联邦模型的测试准确率随着训练的进行先增长至峰值，随后开始逐渐下降。因为在训练过程中，联邦模型会逐渐对样本中的标签噪声过拟合，从而学习更多错误的知识，导致联邦模型的测试准确率下降。另外一个出乎意料的现象是联邦模型的整体剪枝率$\alpha$越大，最优的以及$t=200$轮的测试准确率越高，这与之前样本标签独立同分布和非独立同分布的实验结果恰好相反。对于这一现象，本文认为剪枝率的提高有助于降低模型的复杂度，从而减轻了过拟合的程度。

\newpage

\begin{figure}[!htbp]
    \centering
    \includegraphics[width=0.8\textwidth]{image/chap03/fig_pruning_ratio.pdf}
    \caption{联邦模型的测试准确率与整体剪枝率$\alpha$的关系}
    \label{fig:fig_pruning_ratio}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \includegraphics[width=\textwidth]{image/chap03/fig_noisy_ratio.pdf}
    \caption{样本标签含有噪声时整体剪枝率$\alpha$对联邦训练的影响}
    \label{fig:fig_noisy_ratio}
\end{figure}

图\ref{fig:fig_noisy_ratio}中间的图使用平均FLOPs作为横坐标，反应了客户端在训练模型过程中的平均计算量，右图使用平均上传开销作为横坐标，反应了客户端将训练好的模型上传给服务器产生的通信开销。在固定计算量和通信开销的大部分情况下，联邦模型的整体剪枝率$\alpha$越大，测试准确率越高，且联邦模型达到最优性能所需的通信和计算资源更少。需要注意的是，当剪枝率$\alpha$过大时，联邦模型可能会因网络结构受到严重破坏而无法训练，这与前面的实验结果相同。因此，选择一个合适的剪枝率$\alpha$有助于训练出一个性能良好的联邦模型，同时减少对通信和计算资源的消耗。上述的实验结果将参与后续与其他算法联邦训练效果的对比。

| 剪枝率 | iid         | $\beta=0.5$     | $\beta=0.1$       | 不平衡噪声 |
| ------ | ----------- | --------------- | ----------------- | ---------- |
| 0.0    |             |                 |                   | 0.47538    |
| 0.1    |             |                 |                   | 0.482795   |
| 0.2    |             |                 |                   | 0.48274    |
| 0.3    |             | 0.62996 81      |                   | 0.495345   |
| 0.4    | 0.65627     |                 | 0.429368          | 0.50826    |
| 0.5    |             | 0.62872 103     | 0.437366          | 0.50702    |
| 0.6    | 0.66192     | 0.602213 25     | 0.406688          | 0.505385   |
| 0.7    |             | **0.60322**     | 0.397884          | 0.508045   |
| 0.75   |             | 0.61217 119     |                   |            |
| 0.8    | 0.63904     | **0.60162** 176 | 0.399459          | 0.532715   |
| 0.85   | **0.62232** | **0.58063** 171 | **0.44**          | x          |
| 0.9    | 0.61661     | **0.573965**    | 0.439198 0.354562 | x          |
| 0.95   | x           | **0.54434**     | x                 | x          |



### \subsection{剪枝算法的初始调整系数$\lambda^0$的影响}

\label{subsec:exp-dynamic-ratio}

本小节研究剪枝算法中不同的初始调整系数$\lambda^0$对联邦训练的影响。需要特别说明的是，当$\lambda^0=0.0$时，由等式\ref{eq:f-decay}可知，剪枝模型在训练过程中不会对网络拓扑进行额外的探索，算法退化为普通的动态剪枝的情况。本小节使用的数据集是CIFAR-10，数据划分方式主要是样本标签非独立同分布。此外，由于本小节关注的超参数是初始调整系数$\lambda^0$，因此其他的超参数将会被固定，例如模型聚合算法的初始权衡系数$\gamma^0=1.0$。

图\ref{fig:fig_dynamic_ratio}展示了不同剪枝率情况下，采用不同的初始调整系数$\lambda^0$对联邦模型测试准确率的影响。首先，图中的结果可以证实\ref{subsec:dynamic-pruning-design}节提出的对剪枝模型的参数空间进行探索的有效性。然而，这种探索并不一定能保证联邦模型的性能有所提升，例如图中$\lambda^0$较大的多组测试准确率不如相同剪枝率的$\lambda^0=0.0$的测试准确率。因为$\lambda^0$太大可能会导致网络拓扑再次调整的程度过大，使得模型不能充分地学习，而学习到的知识可能很快就会被抛弃。其次，$\lambda^0$太小导致剪枝模型的网络拓扑并没有对其参数空间进行充分的探索，无法很好地实现动态剪枝在时间维度上的过参数化特性，从而导致联邦训练的效果不佳。最后，图中的结果也说明，整体剪枝率$\alpha$越大，则动态剪枝对于提升联邦模型性能的帮助作用就越大。

\begin{figure}[!htbp]
    \centering
    \includegraphics[width=0.8\textwidth]{image/chap03/fig_dynamic_ratio.pdf}
    \caption{联邦模型的测试准确率与初始调整系数$\lambda^0$的关系}
    \label{fig:fig_dynamic_ratio}
\end{figure}

diri05+agg 1.0

|          | 0.0  | 0.1          | 0.3                  | 0.5                | 0.7                 | 0.9     |
| -------- | ---- | ------------ | -------------------- | ------------------ | ------------------- | ------- |
| 1        | 0.56 | 0.59522/0.58 | 0.5838               | 0.57029            | 0.5511              | 0.50522 |
| 3        | 0.56 | 0.59864/0.59 | 0.59041              | 0.58165            | 0.56907             | 0.54114 |
| 6        | 0.56 | 0.60371/0.59 | **0.58435** 0.593755 | 0.58267            | 0.5783              | 0.5636  |
| 15       | 0.56 | 0.58534      | 0.59823              | **0.5776** 0.59004 | 0.59081/0.58        | 0.58638 |
| 30       | 0.56 | 0.58274      | 0.58466              | 0.58845            | **0.57968** 0.58978 | 0.59008 |
| $\infty$ | 0.56 | 0.56         | 0.56                 | 0.56               | 0.56                | 0.56    |

diri05+agg 0.7

|          | 0.0  | 0.1  | 0.3  | 0.5  | 0.7  | 0.9  |
| -------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 1        | 0.57 |      |      |      |      |      |
| 3        | 0.57 | 0.59 | 0.59 |      |      |      |
| 6        | 0.57 | 0.60 |      |      |      |      |
| 15       | 0.57 |      | 0.58 |      |      |      |
| 30       | 0.57 |      |      |      |      |      |
| $\infty$ | 0.57 | 0.57 | 0.57 | 0.57 | 0.57 | 0.57 |

噪声+agg 1.0

|          | 0.0      | 0.1      | 0.3      | 0.5      | 0.7      | 0.9      |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 1        | 0.532715 |          |          |          |          |          |
| 3        | 0.532715 |          |          |          |          |          |
| 6        | 0.532715 | 0.53     |          |          |          |          |
| 15       | 0.532715 | 0.51     | 0.52     | 0.50     |          |          |
| 30       | 0.532715 | 0.51     | 0.51     | 0.51     |          |          |
| $\infty$ | 0.532715 | 0.532715 | 0.532715 | 0.532715 | 0.532715 | 0.532715 |

噪声+agg 0.7

|          | 0.0  | 0.1      | 0.3      | 0.5      | 0.7  | 0.9  |
| -------- | ---- | -------- | -------- | -------- | ---- | ---- |
| 1        | 0.57 | 0.57     |          |          |      |      |
| 3        | 0.57 | 0.57     | 0.55     |          |      |      |
| 6        | 0.57 | **0.58** | 0.56     | 0.56     |      |      |
| 15       | 0.57 | **0.58** | **0.58** | **0.58** | 0.55 |      |
| 30       | 0.57 | **0.58** | **0.57** | **0.57** |      |      |
| $\infty$ | 0.57 | 0.57     | 0.57     | 0.57     | 0.57 | 0.57 |







| 剪枝率     | iid        | $\beta=0.5$ | $\beta=0.1$   |
| ---------- | ---------- | ----------- | ------------- |
| 0.3（0.0） | 0.6544 a+b | 0.61535 a   | 0.43656 b+c   |
| 0.4        | 0.65676 a  | 0.61896 a   | 0.458429998 b |
| 0.5        | 0.66816 a  | 0.61985 a   | 0.52653 a     |
| 0.6        | 0.64791 a  | 0.62733 a   | 0.42421 a     |
| 0.7        | 0.64565 a  | 0.61294 b   | 0.427035 b    |
| 0.8        | 0.65044 a  | 0.61669 a   | 0.44003 b     |
| 0.85       | 0.62724 a  | 0.59796 a   | 0.36106 b     |
| 0.9        | 0.597009 a | 0.53684 a   | 0.33501 b     |

| 剪枝率  | $\beta=0.1$                     |
| ------- | ------------------------------- |
| **0.4** | 0.42096 x **0.46199** y         |
| **0.5** | **0.4472** x 0.4159 y 0.43205 c |
| **0.6** | **0.41565** x 0.40632 y         |
| **0.7** | **0.44516** x 0.42078 y         |
| 0.8     | 0.38508 x **0.39313** y         |
| 0.85    | **0.34976** x 0.34931 y         |
| 0.9     | **0.37152** x 0.37096 y         |
| 0.95    | **0.324517** x                  |

|      | 1    | 4    | 7    | 10   | 20   | 40   | $\infty$ |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | -------- |
| 0.5  | 0.43 | 0.44 | 0.45 | 0.46 | 0.45 | 0.44 | 0.437366 |
| 0.7  | 0.39 | 0.40 | 0.42 | 0.44 | 0.42 | 0.40 | 0.397884 |
| 0.9  | 0.36 | 0.36 | 0.39 | 0.42 | 0.39 | 0.36 | 0.354562 |

|      | 0.0      | 0.2  | 0.4  | 0.6  | 0.8  |
| ---- | -------- | ---- | ---- | ---- | ---- |
| 0.5  | 0.437366 | 0.44 | 0.46 | 0.46 | 0.45 |
| 0.7  | 0.397884 | 0.40 | 0.42 | 0.44 | 0.42 |
| 0.9  | 0.354562 | 0.36 | 0.39 | 0.42 | 0.39 |

| 调整率 | 0.0           | 0.01    | 0.1               | 0.3                  | 0.5                 | 0.7               | 0.9               |
| ------ | ------------- | ------- | ----------------- | -------------------- | ------------------- | ----------------- | ----------------- |
| 0.1    | **0.52653** a | 0.44886 | 0.49334 - 0.49334 | **0.53636 x** - 0.54 | 0.47661 z - 0.53636 | 0.45227 - 0.47661 | 0.42387 - 0.45227 |
| 0.5    | **0.61985** a | 0.60639 | 0.62149           | 0.623909998 k        | 0.62862 x           | 0.62361           | 0.5961            |
| iid    | **0.66816** a | 0.66017 | 0.66177           | 0.65668              | 0.6482              | 0.64705           | 0.65354           |

| 调整率 | 0.0          | 0.1         | 0.3             | 0.5         | 0.7             | 0.9         |
| ------ | ------------ | ----------- | --------------- | ----------- | --------------- | ----------- |
| 0.5    | **0.52653**  | 0.49334     | 0.53636 x       | 0.47661 z   | 0.45227         | 0.42387     |
| 0.7    | **0.400715** | 0.38801     | 0.392505001     | 0.544505    | 0.392565002     | 0.355240002 |
| 0.9    | **0.33501**  | 0.332654999 | **0.302429999** | 0.370804998 | **0.308260001** | 0.349230003 |

| 调整间隔 | 0.0           | 1                   | 4                | 7             | 10                      | 20                | 40            |
| -------- | ------------- | ------------------- | ---------------- | ------------- | ----------------------- | ----------------- | ------------- |
| 0.1      | **0.52653** a | 0.38415 z           | 0.472735 x+z     | 0.47327 k     | 0.48978 x+z **0.53636** | 0.41252 z+j       | 0.51071 a     |
| 0.5      | **0.61985** a | **0.609295001** a+b | **0.620975** x+z | **0.63119** z | 0.61144 a+b **0.62862** | **0.613469988** a | **0.61186** a |
| iid      | **0.66816** a | 0.64863 a           |                  |               | 0.666059995 a           |                   |               |

| 调整间隔 | 0.0            | 1         | 4            | 7               | 10                      | 20              | 40          |
| -------- | -------------- | --------- | ------------ | --------------- | ----------------------- | --------------- | ----------- |
| 0.5      | **0.52653** a  | 0.38415 z | 0.472735 x+z | 0.47327 k       | 0.48978 x+z **0.53636** | 0.41252 z+j     | 0.51071 a   |
| 0.7      | **0.400715** a | 0.49285   | 0.495795     | **0.283890001** | 0.392505001             | **0.315755001** | 0.381395002 |
| 0.9      | **0.33501**    | 0.44025   | 0.376549999  | **0.307495001** | **0.302429999**         | **0.29852**     | 0.392675    |

| 0.5 - 0.52653 | 1                        | 4                            | 7                                      | 10                                         | 20                              | 40                | $\infin$    |
| ------------- | ------------------------ | ---------------------------- | -------------------------------------- | ------------------------------------------ | ------------------------------- | ----------------- | ----------- |
| 0.0           | 【0.52653】              | 【0.52653】                  | 【0.52653】                            | 【0.52653】                                | 【0.52653】                     | 【0.52653】       | 【0.52653】 |
| 0.1           |                          |                              |                                        | **0.39736** m                              |                                 |                   | 【0.52653】 |
| 0.3           |                          |                              | 0.43887 j **0.474075** k 0.428545003 l | **0.376555002** j                          | **0.414090002** j               |                   | 【0.52653】 |
| 0.4           | 0.191575 x 0.384894998 z | 0.463045 x **0.481304996** z | 0.403725001 x 0.16254 z                | 0.478740002 x 0.412959999 y **0.498885** z | 0.380689996 x **0.411975004** z | **0.511860001** x | 【0.52653】 |
| 0.5           |                          |                              |                                        | **0.384570004** m                          |                                 |                   | 【0.52653】 |
| 0.7           |                          |                              |                                        | **0.413295002** m                          |                                 |                   | 【0.52653】 |
| 0.9           |                          |                              |                                        | **0.141374998** m                          |                                 |                   | 【0.52653】 |

| 0.7 - 0.400715 | 1             | 4              | 7             | 10                | 20            | 40            | $\infin$     |
| -------------- | ------------- | -------------- | ------------- | ----------------- | ------------- | ------------- | ------------ |
| 0.0            | 【0.400715】  | 【0.400715】   | 【0.400715】  | 【0.400715】      | 【0.400715】  | 【0.400715】  | 【0.400715】 |
| 0.1            |               |                |               | **0.38801** m     |               |               | 【0.400715】 |
| 0.3            | **0.49285** m | **0.495795** m | 0.283890001 m | 0.392505001 m     | 0.315755001 m | 0.381395002 m | 【0.400715】 |
| 0.5            |               |                |               | **0.544505** m    |               |               | 【0.400715】 |
| 0.7            |               |                |               | **0.392565002** m |               |               | 【0.400715】 |
| 0.9            |               |                |               | **0.355240002** m |               |               | 【0.400715】 |

| 0.9 - 0.33501 | 1             | 4                 | 7             | 10            | 20          | 40          | $\infin$    |
| ------------- | ------------- | ----------------- | ------------- | ------------- | ----------- | ----------- | ----------- |
| 0.0           | 【0.33501】   | 【0.33501】       | 【0.33501】   | 【0.33501】   | 【0.33501】 | 【0.33501】 | 【0.33501】 |
| 0.1           |               |                   |               | 0.332654999 m |             |             | 【0.33501】 |
| 0.3           | **0.44025** m | **0.376549999** m | 0.307495001 m | 0.302429999 m | 0.29852 m   | 0.392675 m  | 【0.33501】 |
| 0.5           |               |                   |               | 0.370804998 m |             |             | 【0.33501】 |
| 0.7           |               |                   |               | 0.308260001 m |             |             | 【0.33501】 |
| 0.9           |               |                   |               | 0.349230003 m |             |             | 【0.33501】 |